<?php
/**
 * Generated by Haxe 4.3.4
 */

namespace jotun\gaming\actions;

use \php\_Boot\HxAnon;
use \php\Boot;
use \jotun\utils\Filler;
use \haxe\Log;
use \jotun\tools\Utils;
use \jotun\utils\Dice;
use \php\_Boot\HxString;
use \jotun\objects\Query;

/**
 * ...
 * @author Rim Project
 */
class ActionQuery extends Query {
	/**
	 * @var EventContext
	 */
	public $ioContext;

	/**
	 *
	 * 
	 * @return void
	 */
	public function __construct () {
		#src/jotun/gaming/actions/ActionQuery.hx:106: characters 3-10
		parent::__construct();
	}

	/**
	 * @param mixed $value
	 * 
	 * @return bool
	 */
	public function _BOOL ($value) {
		#src/jotun/gaming/actions/ActionQuery.hx:41: characters 3-30
		return Utils::boolean($value);
	}

	/**
	 * @param mixed $value
	 * @param float $alt
	 * 
	 * @return float
	 */
	public function _FLOAT ($value, $alt = null) {
		#src/jotun/gaming/actions/ActionQuery.hx:50: characters 3-113
		$o = (is_string($value) ? \Std::parseFloat($value) : ((is_float($value) || is_int($value)) ? $value : null));
		#src/jotun/gaming/actions/ActionQuery.hx:51: characters 10-29
		if ($o !== null) {
			#src/jotun/gaming/actions/ActionQuery.hx:51: characters 22-23
			return $o;
		} else {
			#src/jotun/gaming/actions/ActionQuery.hx:51: characters 26-29
			return $alt;
		}
	}

	/**
	 * @param mixed $value
	 * @param int $alt
	 * 
	 * @return int
	 */
	public function _INT ($value, $alt = null) {
		#src/jotun/gaming/actions/ActionQuery.hx:45: characters 3-112
		$o = (is_string($value) ? \Std::parseInt($value) : (Boot::isOfType($value, Boot::getClass('Int')) ? $value : null));
		#src/jotun/gaming/actions/ActionQuery.hx:46: characters 10-29
		if ($o !== null) {
			#src/jotun/gaming/actions/ActionQuery.hx:46: characters 22-23
			return $o;
		} else {
			#src/jotun/gaming/actions/ActionQuery.hx:46: characters 26-29
			return $alt;
		}
	}

	/**
	 * @param string $value
	 * 
	 * @return mixed
	 */
	public function _PARAMS ($value) {
		#src/jotun/gaming/actions/ActionQuery.hx:27: characters 3-27
		$params = new HxAnon();
		#src/jotun/gaming/actions/ActionQuery.hx:28: lines 28-36
		if ($value !== null) {
			#src/jotun/gaming/actions/ActionQuery.hx:29: characters 4-38
			$value = HxString::split($value, "+")->join(" ");
			#src/jotun/gaming/actions/ActionQuery.hx:30: lines 30-35
			Dice::Values(HxString::split($value, "&"), function ($v) use (&$params) {
				#src/jotun/gaming/actions/ActionQuery.hx:31: characters 5-44
				$data = HxString::split($v, "=");
				#src/jotun/gaming/actions/ActionQuery.hx:32: lines 32-34
				if ($data->length > 1) {
					#src/jotun/gaming/actions/ActionQuery.hx:33: characters 6-48
					\Reflect::setField($params, ($data->arr[0] ?? null), ($data->arr[1] ?? null));
				}
			});
		}
		#src/jotun/gaming/actions/ActionQuery.hx:37: characters 3-16
		return $params;
	}

	/**
	 * @param mixed $value
	 * 
	 * @return bool
	 */
	public function _isempty ($value) {
		#src/jotun/gaming/actions/ActionQuery.hx:23: characters 10-38
		if ($value !== null) {
			#src/jotun/gaming/actions/ActionQuery.hx:23: characters 27-38
			return $value === "";
		} else {
			#src/jotun/gaming/actions/ActionQuery.hx:23: characters 10-38
			return true;
		}
	}

	/**
	 * @param mixed $a
	 * @param string $r
	 * @param mixed $v
	 * 
	 * @return mixed
	 */
	public function _resolve ($a, $r, $v) {
		#src/jotun/gaming/actions/ActionQuery.hx:59: lines 59-61
		if ($r === null) {
			#src/jotun/gaming/actions/ActionQuery.hx:60: characters 4-11
			$r = "=";
		}
		#src/jotun/gaming/actions/ActionQuery.hx:62: lines 62-97
		if ($r === "+" || $r === "add") {
			#src/jotun/gaming/actions/ActionQuery.hx:66: characters 21-26
			return Boot::addOrConcat($a, $v);
		} else if ($r === "&" || $r === "and") {
			#src/jotun/gaming/actions/ActionQuery.hx:88: characters 21-26
			return $a & $v;
		} else if ($r === "--" || $r === "decrement") {
			#src/jotun/gaming/actions/ActionQuery.hx:72: characters 29-34
			return $a - 1;
		} else if ($r === "/" || $r === "divided") {
			#src/jotun/gaming/actions/ActionQuery.hx:76: characters 25-30
			return $a / $v;
		} else if ($r === "=" || $r === "eq" || $r === "equal") {
			#src/jotun/gaming/actions/ActionQuery.hx:64: characters 28-29
			return $a;
		} else if ($r === "++" || $r === "increment") {
			#src/jotun/gaming/actions/ActionQuery.hx:70: characters 29-34
			return $a + 1;
		} else if ($r === "<<" || $r === "lshift") {
			#src/jotun/gaming/actions/ActionQuery.hx:80: characters 26-32
			return $a << $v;
		} else if ($r === "%" || $r === "mod") {
			#src/jotun/gaming/actions/ActionQuery.hx:78: characters 21-26
			return fmod($a, $v);
		} else if ($r === "*" || $r === "multiply") {
			#src/jotun/gaming/actions/ActionQuery.hx:74: characters 26-31
			return $a * $v;
		} else if ($r === "not" || $r === "~") {
			#src/jotun/gaming/actions/ActionQuery.hx:84: characters 21-34
			return $a & ~$v;
		} else if ($r === "or" || $r === "|") {
			#src/jotun/gaming/actions/ActionQuery.hx:86: characters 20-25
			return $a | $v;
		} else if ($r === "^" || $r === "pow") {
			#src/jotun/gaming/actions/ActionQuery.hx:92: characters 21-35
			return ($a ** $v);
		} else if ($r === "#" || $r === "random") {
			#src/jotun/gaming/actions/ActionQuery.hx:94: characters 25-40
			return $this->rng() * $v + $a;
		} else if ($r === ">>" || $r === "rshift") {
			#src/jotun/gaming/actions/ActionQuery.hx:82: characters 25-31
			return $a >> $v;
		} else if ($r === "-" || $r === "sub") {
			#src/jotun/gaming/actions/ActionQuery.hx:68: characters 21-26
			return $a - $v;
		} else if ($r === "!" || $r === "xor") {
			#src/jotun/gaming/actions/ActionQuery.hx:90: characters 21-26
			return $a ^ $v;
		} else {
			#src/jotun/gaming/actions/ActionQuery.hx:96: characters 14-15
			return $a;
		}
	}

	/**
	 * @return IDataProvider
	 */
	public function getDataProvider () {
		#src/jotun/gaming/actions/ActionQuery.hx:19: characters 3-35
		return $this->ioContext->currentProvider;
	}

	/**
	 * @return float
	 */
	public function rng () {
		#src/jotun/gaming/actions/ActionQuery.hx:55: characters 3-23
		return \mt_rand() / \mt_getrandmax();
	}

	/**
	 * Set value to a variable
	 * setfloat var_name * 0.5 // effect: var_name*=0.5
	 * setfloat var_name / 0.5 // effect: var_name/=0.5
	 * @param	name
	 * @param	rule
	 * @param	value
	 * 
	 * @param string $name
	 * @param string $rule
	 * @param float $value
	 * 
	 * @return ActionQuery
	 */
	public function setfloat ($name, $rule, $value) {
		#src/jotun/gaming/actions/ActionQuery.hx:148: characters 3-50
		$a = $this->getDataProvider()->getFloat($name);
		#src/jotun/gaming/actions/ActionQuery.hx:149: lines 149-152
		if ($this->_isempty($value) && !$this->_isempty($rule)) {
			#src/jotun/gaming/actions/ActionQuery.hx:150: characters 4-24
			$value = $this->_FLOAT($rule);
			#src/jotun/gaming/actions/ActionQuery.hx:151: characters 4-15
			$rule = null;
		}
		#src/jotun/gaming/actions/ActionQuery.hx:153: characters 3-34
		$v = $this->_FLOAT($value, 0);
		#src/jotun/gaming/actions/ActionQuery.hx:154: characters 3-27
		$v = $this->_resolve($a, $rule, $v);
		#src/jotun/gaming/actions/ActionQuery.hx:155: lines 155-157
		if (!Boot::equal($a, $v)) {
			#src/jotun/gaming/actions/ActionQuery.hx:156: characters 4-37
			$this->getDataProvider()->setVar($name, $v);
		}
		#src/jotun/gaming/actions/ActionQuery.hx:158: characters 3-14
		return $this;
	}

	/**
	 * Set value to a variable
	 * setfloat var_name * 2 // effect: var_name*=2
	 * setfloat var_name / 2 // effect: var_name/=2
	 * @param	name
	 * @param	rule
	 * @param	value
	 * 
	 * @param string $name
	 * @param string $rule
	 * @param int $value
	 * 
	 * @return ActionQuery
	 */
	public function setint ($name, $rule, $value) {
		#src/jotun/gaming/actions/ActionQuery.hx:170: characters 3-48
		$a = $this->getDataProvider()->getInt($name);
		#src/jotun/gaming/actions/ActionQuery.hx:171: lines 171-174
		if ($this->_isempty($value) && !$this->_isempty($rule)) {
			#src/jotun/gaming/actions/ActionQuery.hx:172: characters 4-22
			$value = $this->_INT($rule);
			#src/jotun/gaming/actions/ActionQuery.hx:173: characters 4-15
			$rule = null;
		}
		#src/jotun/gaming/actions/ActionQuery.hx:175: characters 3-32
		$v = $this->_INT($value, 0);
		#src/jotun/gaming/actions/ActionQuery.hx:176: characters 3-27
		$v = $this->_resolve($a, $rule, $v);
		#src/jotun/gaming/actions/ActionQuery.hx:177: lines 177-179
		if (!Boot::equal($a, $v)) {
			#src/jotun/gaming/actions/ActionQuery.hx:178: characters 4-46
			$this->getDataProvider()->setVar($name, (int)($v));
		}
		#src/jotun/gaming/actions/ActionQuery.hx:180: characters 3-14
		return $this;
	}

	/**
	 * Set a random number to the var, can be float or int
	 * setrng var_name = 10 50 // effect: var_name = (any value from 10 to 50)
	 * setrng var_name = 100 // effect: var_name = (any value from 0 to 100)
	 * @param	name
	 * @param	rule
	 * @param	min
	 * @param	max
	 * @param	float
	 * 
	 * @param string $name
	 * @param string $rule
	 * @param float $min
	 * @param float $max
	 * @param bool $float
	 * 
	 * @return ActionQuery
	 */
	public function setrng ($name, $rule, $min, $max = null, $float = null) {
		#src/jotun/gaming/actions/ActionQuery.hx:127: lines 127-130
		if ($max === null) {
			#src/jotun/gaming/actions/ActionQuery.hx:128: characters 4-13
			$max = $min;
			#src/jotun/gaming/actions/ActionQuery.hx:129: characters 4-11
			$min = 0;
		}
		#src/jotun/gaming/actions/ActionQuery.hx:131: characters 3-37
		$f = Utils::boolean($float);
		#src/jotun/gaming/actions/ActionQuery.hx:132: characters 3-33
		$a_min = $this->_FLOAT($min);
		#src/jotun/gaming/actions/ActionQuery.hx:133: characters 3-55
		$a_max = $this->_FLOAT($max) + (($f ? 0 : 1)) - $a_min;
		#src/jotun/gaming/actions/ActionQuery.hx:134: characters 3-43
		$value = $this->rng() * $a_max + $a_min;
		#src/jotun/gaming/actions/ActionQuery.hx:135: characters 39-70
		$tmp = ($f ? $value : (int)($value));
		#src/jotun/gaming/actions/ActionQuery.hx:135: characters 3-71
		(($f ? Boot::getInstanceClosure($this, 'setfloat') : Boot::getInstanceClosure($this, 'setint')))($name, $rule, $tmp);
		#src/jotun/gaming/actions/ActionQuery.hx:136: characters 3-14
		return $this;
	}

	/**
	 *
	 * @param	name
	 * @param	rule
	 * @param	value
	 * @return
	 * 
	 * @param string $name
	 * @param string $rule
	 * @param string $value
	 * 
	 * @return ActionQuery
	 */
	public function setstr ($name, $rule, $value) {
		#src/jotun/gaming/actions/ActionQuery.hx:213: characters 3-49
		$a = $this->getDataProvider()->getStr($name);
		#src/jotun/gaming/actions/ActionQuery.hx:214: lines 214-217
		if ($this->_isempty($value)) {
			#src/jotun/gaming/actions/ActionQuery.hx:215: characters 4-16
			$value = $rule;
			#src/jotun/gaming/actions/ActionQuery.hx:216: characters 4-15
			$rule = null;
		}
		#src/jotun/gaming/actions/ActionQuery.hx:218: characters 3-35
		$value = $this->_resolve($a, $rule, $value);
		#src/jotun/gaming/actions/ActionQuery.hx:219: lines 219-221
		if ($a !== $value) {
			#src/jotun/gaming/actions/ActionQuery.hx:220: characters 4-41
			$this->getDataProvider()->setStr($name, $value);
		}
		#src/jotun/gaming/actions/ActionQuery.hx:222: characters 3-14
		return $this;
	}

	/**
	 * Toggle Swith value
	 * @param	name
	 * @param	value
	 * @return
	 * 
	 * @param string $name
	 * @param bool $value
	 * 
	 * @return ActionQuery
	 */
	public function setswitch ($name, $value) {
		#src/jotun/gaming/actions/ActionQuery.hx:232: characters 3-50
		$a = $this->getDataProvider()->getSwitch($name);
		#src/jotun/gaming/actions/ActionQuery.hx:233: characters 3-56
		$v = $this->_isempty($value) || Utils::boolean($value);
		#src/jotun/gaming/actions/ActionQuery.hx:234: lines 234-236
		if ($a !== $v) {
			#src/jotun/gaming/actions/ActionQuery.hx:235: characters 4-40
			$this->getDataProvider()->setSwitch($name, $v);
		}
		#src/jotun/gaming/actions/ActionQuery.hx:237: characters 3-14
		return $this;
	}

	/**
	 * Set value to a variable
	 * setvar var_name = foobar // effect: var_name="foobar"
	 * @param	name
	 * @param	rule
	 * @param	value
	 * 
	 * @param string $name
	 * @param string $rule
	 * @param mixed $value
	 * 
	 * @return ActionQuery
	 */
	public function setvar ($name, $rule, $value) {
		#src/jotun/gaming/actions/ActionQuery.hx:191: characters 3-50
		$a = $this->getDataProvider()->getVar($name);
		#src/jotun/gaming/actions/ActionQuery.hx:192: lines 192-195
		if ($this->_isempty($value)) {
			#src/jotun/gaming/actions/ActionQuery.hx:193: characters 4-16
			$value = $rule;
			#src/jotun/gaming/actions/ActionQuery.hx:194: characters 4-15
			$rule = null;
		}
		#src/jotun/gaming/actions/ActionQuery.hx:196: lines 196-202
		if (is_string($a)) {
			#src/jotun/gaming/actions/ActionQuery.hx:197: characters 4-33
			return $this->setstr($a, $rule, $value);
		} else if (is_bool($a)) {
			#src/jotun/gaming/actions/ActionQuery.hx:199: characters 4-33
			return $this->setswitch($name, $value);
		} else {
			#src/jotun/gaming/actions/ActionQuery.hx:201: characters 4-36
			return $this->setint($name, $rule, $value);
		}
	}

	/**
	 * @param array $messages
	 * 
	 * @return ActionQuery
	 */
	public function tracer (...$messages) {
		#src/jotun/gaming/actions/ActionQuery.hx:110: characters 3-8
		(Log::$trace)("[ActionQuery:tracer] " . (Filler::to(\Array_hx::wrap($messages)->join(" "), $this->ioContext)??'null'), new HxAnon([
			"fileName" => "src/jotun/gaming/actions/ActionQuery.hx",
			"lineNumber" => 110,
			"className" => "jotun.gaming.actions.ActionQuery",
			"methodName" => "tracer",
		]));
		#src/jotun/gaming/actions/ActionQuery.hx:111: characters 3-14
		return $this;
	}
}

Boot::registerClass(ActionQuery::class, 'jotun.gaming.actions.ActionQuery');
