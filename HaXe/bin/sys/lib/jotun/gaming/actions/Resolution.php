<?php
/**
 * Generated by Haxe 4.3.4
 */

namespace jotun\gaming\actions;

use \php\Boot;
use \jotun\tools\Utils;

/**
 * ...
 * @author Rim Project
 */
class Resolution {
	/**
	 * @var bool
	 */
	public $_stopped;
	/**
	 * @var string
	 */
	public $_type;
	/**
	 * @var string
	 */
	public $breakon;
	/**
	 * @var Events
	 */
	public $fail;
	/**
	 * @var string
	 */
	public $id;
	/**
	 * @var string[]|\Array_hx
	 */
	public $query;
	/**
	 * @var bool
	 */
	public $reverse;
	/**
	 * @var Events
	 */
	public $then;

	/**
	 * @param string $type
	 * @param mixed $data
	 * 
	 * @return void
	 */
	public function __construct ($type, $data) {
		#src/jotun/gaming/actions/Resolution.hx:27: characters 3-15
		$this->_type = $type;
		#src/jotun/gaming/actions/Resolution.hx:28: characters 3-40
		$this->reverse = Utils::boolean(Boot::dynamicField($data, 'reverse'));
		#src/jotun/gaming/actions/Resolution.hx:29: lines 29-31
		if ($this->breakon !== null) {
			#src/jotun/gaming/actions/Resolution.hx:30: characters 4-35
			$this->breakon = \mb_strtolower($this->breakon);
		}
		#src/jotun/gaming/actions/Resolution.hx:32: lines 32-37
		if ((Boot::dynamicField($data, 'query') instanceof \Array_hx)) {
			#src/jotun/gaming/actions/Resolution.hx:33: characters 4-22
			$this->query = Boot::dynamicField($data, 'query');
			#src/jotun/gaming/actions/Resolution.hx:34: characters 4-28
			$_this = $this->query;
			$_this->length = \array_unshift($_this->arr, "@result");
		} else if (Utils::isValid(Boot::dynamicField($data, 'query'))) {
			#src/jotun/gaming/actions/Resolution.hx:36: characters 4-35
			$this->query = \Array_hx::wrap([
				"@result",
				Boot::dynamicField($data, 'query'),
			]);
		}
		#src/jotun/gaming/actions/Resolution.hx:38: lines 38-40
		if (Boot::dynamicField($data, 'then') !== null) {
			#src/jotun/gaming/actions/Resolution.hx:39: characters 4-52
			$this->then = new Events(($this->_type??'null') . ":success", Boot::dynamicField($data, 'then'));
		}
		#src/jotun/gaming/actions/Resolution.hx:41: lines 41-43
		if (Boot::dynamicField($data, 'fail') !== null) {
			#src/jotun/gaming/actions/Resolution.hx:42: characters 4-49
			$this->fail = new Events(($this->_type??'null') . ":fail", Boot::dynamicField($data, 'fail'));
		}
		#src/jotun/gaming/actions/Resolution.hx:44: characters 3-15
		$this->id = Boot::dynamicField($data, 'id');
	}

	/**
	 * @return void
	 */
	public function connect () {
		#src/jotun/gaming/actions/Resolution.hx:74: characters 3-19
		$this->_stopped = false;
	}

	/**
	 * @return void
	 */
	public function disconnect () {
		#src/jotun/gaming/actions/Resolution.hx:78: characters 3-18
		$this->_stopped = true;
	}

	/**
	 * @return int
	 */
	public function length () {
		#src/jotun/gaming/actions/Resolution.hx:82: characters 10-46
		if ($this->query !== null) {
			#src/jotun/gaming/actions/Resolution.hx:82: characters 26-42
			return $this->query->length - 1;
		} else {
			#src/jotun/gaming/actions/Resolution.hx:82: characters 45-46
			return 0;
		}
	}

	/**
	 * @param bool $result
	 * @param mixed $data
	 * @param string $name
	 * 
	 * @return void
	 */
	public function release ($result, $data = null, $name = null) {
		#src/jotun/gaming/actions/Resolution.hx:67: lines 67-70
		if ($this->_stopped) {
			#src/jotun/gaming/actions/Resolution.hx:68: characters 4-20
			$this->_stopped = false;
			#src/jotun/gaming/actions/Resolution.hx:69: characters 4-68
			$this->resolve($result, EventController::createContext($name, $data, null));
		}
	}

	/**
	 * @param bool $result
	 * @param EventContext $context
	 * 
	 * @return bool
	 */
	public function resolve ($result, $context) {
		#src/jotun/gaming/actions/Resolution.hx:48: characters 3-18
		++$context->ident;
		#src/jotun/gaming/actions/Resolution.hx:49: lines 49-57
		if ($result) {
			#src/jotun/gaming/actions/Resolution.hx:50: lines 50-52
			if ($this->then !== null) {
				#src/jotun/gaming/actions/Resolution.hx:51: characters 5-22
				$this->then->run($context);
			}
		} else if ($this->fail !== null) {
			#src/jotun/gaming/actions/Resolution.hx:55: characters 5-22
			$this->fail->run($context);
		}
		#src/jotun/gaming/actions/Resolution.hx:58: characters 3-18
		--$context->ident;
		#src/jotun/gaming/actions/Resolution.hx:59: characters 10-36
		if ($this->reverse) {
			#src/jotun/gaming/actions/Resolution.hx:59: characters 20-27
			return !$result;
		} else {
			#src/jotun/gaming/actions/Resolution.hx:59: characters 30-36
			return $result;
		}
	}

	/**
	 * @param bool $result
	 * 
	 * @return bool
	 */
	public function willBreakOn ($result) {
		#src/jotun/gaming/actions/Resolution.hx:63: characters 10-91
		if (!($this->_stopped || ($this->breakon === "*"))) {
			#src/jotun/gaming/actions/Resolution.hx:63: characters 40-91
			if ($result) {
				#src/jotun/gaming/actions/Resolution.hx:63: characters 50-70
				return $this->breakon === "success";
			} else {
				#src/jotun/gaming/actions/Resolution.hx:63: characters 73-90
				return $this->breakon === "fail";
			}
		} else {
			#src/jotun/gaming/actions/Resolution.hx:63: characters 10-91
			return true;
		}
	}
}

Boot::registerClass(Resolution::class, 'jotun.gaming.actions.Resolution');
