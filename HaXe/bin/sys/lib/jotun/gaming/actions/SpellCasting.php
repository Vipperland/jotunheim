<?php
/**
 * Generated by Haxe 4.3.6
 */

namespace jotun\gaming\actions;

use \php\_Boot\HxAnon;
use \php\Boot;
use \jotun\tools\Utils;

/**
 * ...
 * @author Rafael Moreira
 */
class SpellCasting {
	/**
	 * @var SpellCastAction
	 */
	public $action;
	/**
	 * @var int
	 */
	public $chain;
	/**
	 * @var SpellController
	 */
	public $controller;
	/**
	 * @var IDataProvider
	 */
	public $currentProvider;
	/**
	 * @var IDataProvider
	 */
	public $dataProvider;
	/**
	 * @var bool
	 */
	public $debug;
	/**
	 * @var bool
	 */
	public $ended;
	/**
	 * @var SpellCastContext
	 */
	public $event;
	/**
	 * @var Action[]|\Array_hx
	 */
	public $history;
	/**
	 * @var int
	 */
	public $ident;
	/**
	 * @var string[]|\Array_hx
	 */
	public $log;
	/**
	 * @var string
	 */
	public $name;
	/**
	 * @var mixed
	 */
	public $origin;
	/**
	 * @var SpellCasting
	 */
	public $parent;
	/**
	 * @var IDataProvider
	 */
	public $requestProvider;
	/**
	 * @var SpellCastRequirement
	 */
	public $requirement;
	/**
	 * @var int
	 */
	public $ticks;

	/**
	 * @param string $name
	 * @param mixed $data
	 * @param IDataProvider $provider
	 * @param SpellController $controller
	 * @param bool $debug
	 * 
	 * @return void
	 */
	public function __construct ($name, $data, $provider, $controller, $debug) {
		#src/jotun/gaming/actions/SpellCasting.hx:50: characters 3-21
		$this->origin = $data;
		#src/jotun/gaming/actions/SpellCasting.hx:51: characters 3-19
		$this->name = $name;
		#src/jotun/gaming/actions/SpellCasting.hx:52: characters 3-21
		$this->debug = $debug;
		#src/jotun/gaming/actions/SpellCasting.hx:53: characters 3-21
		$this->ended = false;
		#src/jotun/gaming/actions/SpellCasting.hx:54: characters 3-16
		$this->log = new \Array_hx();
		#src/jotun/gaming/actions/SpellCasting.hx:55: characters 3-17
		$this->ident = 0;
		#src/jotun/gaming/actions/SpellCasting.hx:56: characters 3-17
		$this->chain = 0;
		#src/jotun/gaming/actions/SpellCasting.hx:57: characters 3-17
		$this->ticks = 0;
		#src/jotun/gaming/actions/SpellCasting.hx:58: characters 3-38
		$this->event = new HxAnon(["current" => null]);
		#src/jotun/gaming/actions/SpellCasting.hx:59: characters 3-60
		$this->action = new HxAnon([
			"target" => null,
			"count" => 0,
			"queries" => 0,
		]);
		#src/jotun/gaming/actions/SpellCasting.hx:60: characters 3-65
		$this->requirement = new HxAnon([
			"target" => null,
			"count" => 0,
			"queries" => 0,
		]);
		#src/jotun/gaming/actions/SpellCasting.hx:61: characters 3-20
		$this->history = new \Array_hx();
		#src/jotun/gaming/actions/SpellCasting.hx:62: characters 3-31
		$this->dataProvider = $provider;
		#src/jotun/gaming/actions/SpellCasting.hx:63: characters 3-34
		$this->currentProvider = $provider;
		#src/jotun/gaming/actions/SpellCasting.hx:64: characters 3-31
		$this->controller = $controller;
	}

	/**
	 * @param int $i
	 * @param string $message
	 * 
	 * @return void
	 */
	public function addLog ($i, $message) {
		#src/jotun/gaming/actions/SpellCasting.hx:93: characters 3-72
		$this->log->offsetSet($this->log->length, (Utils::prefix("", $this->ident + $this->chain + $i, "\x09")??'null') . ($message??'null'));
	}

	/**
	 * @return Action
	 */
	public function previous () {
		#src/jotun/gaming/actions/SpellCasting.hx:106: lines 106-110
		if ($this->action->count > 1) {
			#src/jotun/gaming/actions/SpellCasting.hx:107: characters 4-41
			return ($this->history->arr[$this->action->count - 2] ?? null);
		} else {
			#src/jotun/gaming/actions/SpellCasting.hx:109: characters 4-15
			return null;
		}
	}

	/**
	 * @param Action $a
	 * 
	 * @return void
	 */
	public function registerAction ($a) {
		#src/jotun/gaming/actions/SpellCasting.hx:72: characters 3-20
		$this->action->target = $a;
		#src/jotun/gaming/actions/SpellCasting.hx:73: characters 3-17
		++$this->action->count;
		#src/jotun/gaming/actions/SpellCasting.hx:74: characters 3-23
		$_this = $this->history;
		$_this->arr[$_this->length++] = $a;
	}

	/**
	 * @param string $q
	 * 
	 * @return void
	 */
	public function registerActionQuery ($q) {
		#src/jotun/gaming/actions/SpellCasting.hx:78: characters 3-19
		$this->action->query = $q;
		#src/jotun/gaming/actions/SpellCasting.hx:79: characters 3-19
		++$this->action->queries;
	}

	/**
	 * @param Spells $e
	 * 
	 * @return void
	 */
	public function registerEvent ($e) {
		#src/jotun/gaming/actions/SpellCasting.hx:68: characters 3-20
		$this->event->current = $e;
	}

	/**
	 * @param Requirement $r
	 * 
	 * @return void
	 */
	public function registerRequirement ($r) {
		#src/jotun/gaming/actions/SpellCasting.hx:83: characters 3-25
		$this->requirement->target = $r;
		#src/jotun/gaming/actions/SpellCasting.hx:84: characters 3-22
		++$this->requirement->count;
	}

	/**
	 * @param string $q
	 * 
	 * @return void
	 */
	public function registerRequirementQuery ($q) {
		#src/jotun/gaming/actions/SpellCasting.hx:88: characters 3-24
		$this->requirement->query = $q;
		#src/jotun/gaming/actions/SpellCasting.hx:89: characters 3-24
		++$this->requirement->queries;
	}

	/**
	 * @param Resolution $resolution
	 * @param bool $result
	 * 
	 * @return void
	 */
	public function release ($resolution, $result) {
		#src/jotun/gaming/actions/SpellCasting.hx:97: characters 3-68
		$chain = ($result ? $resolution->then : $resolution->fail);
		#src/jotun/gaming/actions/SpellCasting.hx:98: lines 98-102
		if ($chain !== null) {
			#src/jotun/gaming/actions/SpellCasting.hx:99: characters 4-91
			$temp = \Reflect::field(Spells::patch(new HxAnon(["_onActionReleased" => $chain])), "_onActionReleased");
			#src/jotun/gaming/actions/SpellCasting.hx:100: characters 4-52
			$value = $temp;
			\Reflect::setField($this->controller->events, "_onActionReleased", $value);
			#src/jotun/gaming/actions/SpellCasting.hx:101: characters 4-63
			$this->controller->call("_onActionReleased", $this->origin, $this->dataProvider);
		}
	}
}

Boot::registerClass(SpellCasting::class, 'jotun.gaming.actions.SpellCasting');
