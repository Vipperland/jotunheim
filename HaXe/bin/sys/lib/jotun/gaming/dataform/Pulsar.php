<?php
/**
 * Generated by Haxe 4.3.0
 */

namespace jotun\gaming\dataform;

use \jotun\serial\Packager;
use \php\_Boot\HxAnon;
use \jotun\tools\Key;
use \php\Boot;
use \haxe\Exception;
use \jotun\signals\Signals;
use \jotun\utils\Dice;
use \jotun\errors\Error;
use \php\_Boot\HxString;

/**
 * ...
 * @author Rim Project
 */
class Pulsar {
	/**
	 * @var int
	 */
	static public $BLOCK_SIZE = 64;
	/**
	 * @var int
	 */
	static public $ID_SIZE = 32;
	/**
	 * @var mixed
	 */
	static public $_dictio;

	/**
	 * @var mixed
	 */
	public $_open_links;
	/**
	 * @var Signals
	 */
	public $signals;

	/**
	 * @param string $name
	 * @param string[]|\Array_hx $r
	 * 
	 * @return Spark
	 */
	public static function construct ($name, $r) {
		#src/jotun/gaming/dataform/Pulsar.hx:49: characters 3-24
		$O = null;
		#src/jotun/gaming/dataform/Pulsar.hx:50: characters 3-22
		$o = null;
		#src/jotun/gaming/dataform/Pulsar.hx:51: characters 3-22
		$indexable = null;
		#src/jotun/gaming/dataform/Pulsar.hx:52: lines 52-55
		if (\Reflect::hasField(Pulsar::$_dictio, $name)) {
			#src/jotun/gaming/dataform/Pulsar.hx:53: characters 4-36
			$O = \Reflect::field(Pulsar::$_dictio, $name);
			#src/jotun/gaming/dataform/Pulsar.hx:54: characters 25-36
			$tmp = Boot::dynamicField($O, 'Construct');
			#src/jotun/gaming/dataform/Pulsar.hx:54: characters 4-43
			$o = new $tmp->phpClassName($name);
		}
		#src/jotun/gaming/dataform/Pulsar.hx:56: lines 56-66
		if ($o !== null) {
			#src/jotun/gaming/dataform/Pulsar.hx:57: lines 57-65
			if ($r->length === 3) {
				#src/jotun/gaming/dataform/Pulsar.hx:58: characters 5-16
				$o->id = ($r->arr[1] ?? null);
				#src/jotun/gaming/dataform/Pulsar.hx:59: characters 5-18
				$o->merge(($r->arr[2] ?? null));
			} else if ($r->length === 2) {
				#src/jotun/gaming/dataform/Pulsar.hx:61: lines 61-63
				if (Boot::dynamicField($O, 'Indexable')) {
					#src/jotun/gaming/dataform/Pulsar.hx:62: characters 6-29
					$o->id = Key::GEN(Pulsar::$ID_SIZE);
				}
				#src/jotun/gaming/dataform/Pulsar.hx:64: characters 5-18
				$o->merge(($r->arr[1] ?? null));
			}
		}
		#src/jotun/gaming/dataform/Pulsar.hx:67: characters 3-11
		return $o;
	}

	/**
	 * @param string $data
	 * 
	 * @return Pulsar
	 */
	public static function create ($data) {
		#src/jotun/gaming/dataform/Pulsar.hx:91: characters 3-26
		return new Pulsar($data);
	}

	/**
	 * @param mixed $data
	 * 
	 * @return string[]|\Array_hx
	 */
	public static function extract ($data) {
		#src/jotun/gaming/dataform/Pulsar.hx:83: characters 3-28
		$a = new \Array_hx();
		#src/jotun/gaming/dataform/Pulsar.hx:84: lines 84-86
		Dice::Params($data, function ($p) use (&$a) {
			#src/jotun/gaming/dataform/Pulsar.hx:85: characters 4-19
			$a->offsetSet($a->length, $p);
		});
		#src/jotun/gaming/dataform/Pulsar.hx:87: characters 3-11
		return $a;
	}

	/**
	 * @param string $name
	 * 
	 * @return bool
	 */
	public static function isIndexable ($name) {
		#src/jotun/gaming/dataform/Pulsar.hx:71: characters 10-90
		if (\Reflect::hasField(Pulsar::$_dictio, $name)) {
			#src/jotun/gaming/dataform/Pulsar.hx:71: characters 44-82
			return Boot::dynamicField(\Reflect::field(Pulsar::$_dictio, $name), 'Indexable');
		} else {
			#src/jotun/gaming/dataform/Pulsar.hx:71: characters 85-90
			return false;
		}
	}

	/**
	 * @param string $name
	 * 
	 * @return bool
	 */
	public static function isList ($name) {
		#src/jotun/gaming/dataform/Pulsar.hx:75: characters 10-87
		if (\Reflect::hasField(Pulsar::$_dictio, $name)) {
			#src/jotun/gaming/dataform/Pulsar.hx:75: characters 44-79
			return Boot::dynamicField(\Reflect::field(Pulsar::$_dictio, $name), 'IsList');
		} else {
			#src/jotun/gaming/dataform/Pulsar.hx:75: characters 82-87
			return false;
		}
	}

	/**
	 *
	 * @param	name			Pulsar object name
	 * @param	props		Object props to be mapped
	 * @param	objClass		Object Class to initialize
	 * @param	indexable		If true, generate an alphanumeric 32 length unique ID for each instance
	 * 
	 * @param string $name
	 * @param mixed $props
	 * @param mixed $objClass
	 * @param bool $indexable
	 * 
	 * @return void
	 */
	public static function map ($name, $props, $objClass = null, $indexable = false) {
		#src/jotun/gaming/dataform/Pulsar.hx:41: lines 41-45
		if ($indexable === null) {
			$indexable = false;
		}
		\Reflect::setField(Pulsar::$_dictio, $name, new HxAnon([
			"Construct" => ($objClass === null ? Boot::getClass(Spark::class) : $objClass),
			"Properties" => ($props === null ? null : $props),
			"Indexable" => $indexable === true,
		]));
	}

	/**
	 * @param string $name
	 * 
	 * @return string[]|\Array_hx
	 */
	public static function propertiesOf ($name) {
		#src/jotun/gaming/dataform/Pulsar.hx:79: characters 10-90
		if (\Reflect::hasField(Pulsar::$_dictio, $name)) {
			#src/jotun/gaming/dataform/Pulsar.hx:79: characters 44-83
			return Boot::dynamicField(\Reflect::field(Pulsar::$_dictio, $name), 'Properties');
		} else {
			#src/jotun/gaming/dataform/Pulsar.hx:79: characters 86-90
			return null;
		}
	}

	/**
	 * @param string $data
	 * 
	 * @return void
	 */
	public function __construct ($data = null) {
		#src/jotun/gaming/dataform/Pulsar.hx:167: characters 3-19
		$this->_open_links = new HxAnon();
		#src/jotun/gaming/dataform/Pulsar.hx:168: characters 3-30
		$this->signals = new Signals($this);
		#src/jotun/gaming/dataform/Pulsar.hx:169: lines 169-171
		if (($data !== null) && (mb_strlen($data) > 0)) {
			#src/jotun/gaming/dataform/Pulsar.hx:170: characters 4-15
			$this->parse($data);
		}
	}

	/**
	 * @param string[]|\Array_hx $r
	 * 
	 * @return void
	 */
	public function _delete ($r) {
		#src/jotun/gaming/dataform/Pulsar.hx:126: lines 126-131
		if ($r->length === 2) {
			#src/jotun/gaming/dataform/Pulsar.hx:127: characters 4-34
			$x = $this->link(($r->arr[0] ?? null));
			#src/jotun/gaming/dataform/Pulsar.hx:128: lines 128-130
			if ($x !== null) {
				#src/jotun/gaming/dataform/Pulsar.hx:129: characters 5-40
				$this->_onLinkDelete($x->delete(($r->arr[1] ?? null), true));
			}
		}
	}

	/**
	 * @param string $r
	 * 
	 * @return string
	 */
	public function _encode ($r) {
		#src/jotun/gaming/dataform/Pulsar.hx:291: characters 3-31
		$r = Packager::encodeBase64($r);
		#src/jotun/gaming/dataform/Pulsar.hx:292: characters 3-17
		$i = 0;
		#src/jotun/gaming/dataform/Pulsar.hx:293: lines 293-296
		while (\mb_substr($r, mb_strlen($r) - 1, 1) === "=") {
			#src/jotun/gaming/dataform/Pulsar.hx:294: characters 4-36
			$r = HxString::substring($r, 0, mb_strlen($r) - 1);
			#src/jotun/gaming/dataform/Pulsar.hx:295: characters 4-7
			++$i;
		}
		#src/jotun/gaming/dataform/Pulsar.hx:297: characters 3-42
		$r = "#" . (Packager::md5Encode($r)??'null') . ($i??'null') . ($r??'null');
		#src/jotun/gaming/dataform/Pulsar.hx:298: characters 3-8
		$i = 0;
		#src/jotun/gaming/dataform/Pulsar.hx:299: characters 3-22
		$nr = "";
		#src/jotun/gaming/dataform/Pulsar.hx:300: characters 3-26
		$len = mb_strlen($r);
		#src/jotun/gaming/dataform/Pulsar.hx:301: lines 301-304
		while ($i < $len) {
			#src/jotun/gaming/dataform/Pulsar.hx:302: characters 4-40
			$nr = ($nr??'null') . (\mb_substr($r, $i, Pulsar::$BLOCK_SIZE)??'null') . "\x0A";
			#src/jotun/gaming/dataform/Pulsar.hx:303: characters 4-19
			$i += Pulsar::$BLOCK_SIZE;
		}
		#src/jotun/gaming/dataform/Pulsar.hx:305: characters 3-38
		return HxString::substring($nr, 0, mb_strlen($nr) - 1);
	}

	/**
	 * @param Spark $o
	 * @param string[]|\Array_hx $r
	 * 
	 * @return bool
	 */
	public function _exists ($o, $r) {
		#src/jotun/gaming/dataform/Pulsar.hx:106: lines 106-111
		if ($r->length >= 2) {
			#src/jotun/gaming/dataform/Pulsar.hx:107: characters 4-34
			$x = $this->link(($r->arr[0] ?? null));
			#src/jotun/gaming/dataform/Pulsar.hx:108: lines 108-110
			if ($x !== null) {
				#src/jotun/gaming/dataform/Pulsar.hx:109: characters 5-26
				return $x->exists(($r->arr[1] ?? null));
			}
		}
		#src/jotun/gaming/dataform/Pulsar.hx:112: characters 3-15
		return false;
	}

	/**
	 * @param string $name
	 * 
	 * @return PulsarLink
	 */
	public function _getOrCreate ($name) {
		#src/jotun/gaming/dataform/Pulsar.hx:97: characters 3-55
		$x = \Reflect::field($this->_open_links, $name);
		#src/jotun/gaming/dataform/Pulsar.hx:98: lines 98-101
		if ($x === null) {
			#src/jotun/gaming/dataform/Pulsar.hx:99: characters 4-28
			$x = new PulsarLink($name);
			#src/jotun/gaming/dataform/Pulsar.hx:100: characters 4-42
			\Reflect::setField($this->_open_links, $name, $x);
		}
		#src/jotun/gaming/dataform/Pulsar.hx:102: characters 3-11
		return $x;
	}

	/**
	 * @param string[]|\Array_hx $r
	 * 
	 * @return Spark
	 */
	public function _grab ($r) {
		#src/jotun/gaming/dataform/Pulsar.hx:116: lines 116-121
		if ($r->length >= 2) {
			#src/jotun/gaming/dataform/Pulsar.hx:117: characters 4-34
			$x = $this->link(($r->arr[0] ?? null));
			#src/jotun/gaming/dataform/Pulsar.hx:118: lines 118-120
			if ($x !== null) {
				#src/jotun/gaming/dataform/Pulsar.hx:119: characters 5-23
				return $x->get(($r->arr[1] ?? null));
			}
		}
		#src/jotun/gaming/dataform/Pulsar.hx:122: characters 3-14
		return null;
	}

	/**
	 * @param Spark $o
	 * 
	 * @return void
	 */
	public function _onLinkAdd ($o) {
		#src/jotun/gaming/dataform/Pulsar.hx:135: characters 3-46
		$this->signals->call(PulsarSignals::$LINK_CREATED, $o);
	}

	/**
	 * @param Spark $o
	 * 
	 * @return void
	 */
	public function _onLinkDelete ($o) {
		#src/jotun/gaming/dataform/Pulsar.hx:145: characters 3-46
		$this->signals->call(PulsarSignals::$LINK_DELETED, $o);
	}

	/**
	 * @param Spark $o
	 * 
	 * @return void
	 */
	public function _onLinkUpdate ($o) {
		#src/jotun/gaming/dataform/Pulsar.hx:155: characters 3-46
		$this->signals->call(PulsarSignals::$LINK_UPDATED, $o);
	}

	/**
	 * @param Spark $o
	 * 
	 * @return void
	 */
	public function _onObjectAdd ($o) {
		#src/jotun/gaming/dataform/Pulsar.hx:139: lines 139-141
		if ($o !== null) {
			#src/jotun/gaming/dataform/Pulsar.hx:140: characters 4-48
			$this->signals->call(PulsarSignals::$SPARK_CREATED, $o);
		}
	}

	/**
	 * @param Spark $o
	 * 
	 * @return void
	 */
	public function _onObjectDelete ($o) {
		#src/jotun/gaming/dataform/Pulsar.hx:149: lines 149-151
		if ($o !== null) {
			#src/jotun/gaming/dataform/Pulsar.hx:150: characters 4-48
			$this->signals->call(PulsarSignals::$SPARK_DELETED, $o);
		}
	}

	/**
	 * @param Spark $o
	 * 
	 * @return void
	 */
	public function _onObjectUpdate ($o) {
		#src/jotun/gaming/dataform/Pulsar.hx:159: lines 159-161
		if ($o !== null) {
			#src/jotun/gaming/dataform/Pulsar.hx:160: characters 4-48
			$this->signals->call(PulsarSignals::$SPARK_UPDATED, $o);
		}
	}

	/**
	 * @param bool $encode
	 * @param bool $changes
	 * @param string $name
	 * 
	 * @return string
	 */
	public function _toString ($encode = null, $changes = null, $name = null) {
		#src/jotun/gaming/dataform/Pulsar.hx:309: characters 3-21
		$r = "";
		#src/jotun/gaming/dataform/Pulsar.hx:310: characters 3-23
		$c = null;
		#src/jotun/gaming/dataform/Pulsar.hx:311: lines 311-322
		Dice::Values($this->_open_links, function ($list) use (&$name, &$c, &$changes, &$r) {
			#src/jotun/gaming/dataform/Pulsar.hx:312: lines 312-321
			if (($name === null) || $list->is($name)) {
				#src/jotun/gaming/dataform/Pulsar.hx:314: characters 5-32
				$c = $list->stringify($changes);
				#src/jotun/gaming/dataform/Pulsar.hx:315: lines 315-320
				if ($c !== null) {
					#src/jotun/gaming/dataform/Pulsar.hx:316: lines 316-318
					if (mb_strlen($r) > 0) {
						#src/jotun/gaming/dataform/Pulsar.hx:317: characters 7-16
						$r = ($r??'null') . "\x0A";
					}
					#src/jotun/gaming/dataform/Pulsar.hx:319: characters 6-12
					$r = ($r??'null') . ($c??'null');
				}
			}
		});
		#src/jotun/gaming/dataform/Pulsar.hx:323: lines 323-325
		if ($encode) {
			#src/jotun/gaming/dataform/Pulsar.hx:324: characters 4-18
			$r = $this->_encode($r);
		}
		#src/jotun/gaming/dataform/Pulsar.hx:326: characters 3-11
		return $r;
	}

	/**
	 * @return Pulsar
	 */
	public function clone () {
		#src/jotun/gaming/dataform/Pulsar.hx:380: characters 3-31
		$o = new Pulsar();
		#src/jotun/gaming/dataform/Pulsar.hx:381: characters 3-27
		$o->parse($this->toString(false));
		#src/jotun/gaming/dataform/Pulsar.hx:382: characters 3-11
		return $o;
	}

	/**
	 * @return void
	 */
	public function commit () {
		#src/jotun/gaming/dataform/Pulsar.hx:374: lines 374-376
		Dice::Values($this->_open_links, function ($list) {
			#src/jotun/gaming/dataform/Pulsar.hx:375: characters 4-17
			$list->commit();
		});
	}

	/**
	 * @param \Closure $handler
	 * 
	 * @return void
	 */
	public function each ($handler) {
		#src/jotun/gaming/dataform/Pulsar.hx:362: characters 3-36
		Dice::Values($this->_open_links, $handler);
	}

	/**
	 * @param string $name
	 * 
	 * @return bool
	 */
	public function exists ($name) {
		#src/jotun/gaming/dataform/Pulsar.hx:346: characters 3-45
		return \Reflect::hasField($this->_open_links, $name);
	}

	/**
	 * @return mixed
	 */
	public function getObject () {
		#src/jotun/gaming/dataform/Pulsar.hx:386: characters 3-22
		$r = new HxAnon();
		#src/jotun/gaming/dataform/Pulsar.hx:387: lines 387-393
		Dice::All($this->_open_links, function ($p, $v) use (&$r) {
			#src/jotun/gaming/dataform/Pulsar.hx:388: lines 388-392
			if (!\Reflect::hasField($r, $p)) {
				#src/jotun/gaming/dataform/Pulsar.hx:389: characters 5-66
				\Reflect::setField($r, $p, $v->getObject(($v->isSingle() ? null : new \Array_hx())));
			} else {
				#src/jotun/gaming/dataform/Pulsar.hx:391: characters 5-37
				$v->getObject(\Reflect::field($r, $p));
			}
		});
		#src/jotun/gaming/dataform/Pulsar.hx:394: characters 3-11
		return $r;
	}

	/**
	 * @param	o
	 * @return
	 * 
	 * @param Spark $o
	 * 
	 * @return bool
	 */
	public function insert ($o) {
		#src/jotun/gaming/dataform/Pulsar.hx:180: characters 3-33
		$name = $o->getName();
		#src/jotun/gaming/dataform/Pulsar.hx:181: lines 181-192
		if (($name !== null) && (mb_strlen($name) > 0)) {
			#src/jotun/gaming/dataform/Pulsar.hx:182: characters 4-42
			$x = $this->_getOrCreate($name);
			#src/jotun/gaming/dataform/Pulsar.hx:184: lines 184-188
			if (Pulsar::isIndexable($name)) {
				#src/jotun/gaming/dataform/Pulsar.hx:185: lines 185-187
				while (($o->id === null) && !$x->exists($o->id)) {
					#src/jotun/gaming/dataform/Pulsar.hx:186: characters 6-29
					$o->id = Key::GEN(Pulsar::$ID_SIZE);
				}
			}
			#src/jotun/gaming/dataform/Pulsar.hx:189: characters 4-15
			$x->insert($o);
		} else {
			#src/jotun/gaming/dataform/Pulsar.hx:191: characters 4-12
			$o = null;
		}
		#src/jotun/gaming/dataform/Pulsar.hx:193: characters 3-19
		return $o !== null;
	}

	/**
	 * @param string $name
	 * 
	 * @return PulsarLink
	 */
	public function link ($name) {
		#src/jotun/gaming/dataform/Pulsar.hx:350: characters 3-28
		return $this->_getOrCreate($name);
	}

	/**
	 * @return PulsarLink[]|\Array_hx
	 */
	public function links () {
		#src/jotun/gaming/dataform/Pulsar.hx:354: characters 3-32
		$r = new \Array_hx();
		#src/jotun/gaming/dataform/Pulsar.hx:355: lines 355-357
		Dice::Values($this->_open_links, function ($v) use (&$r) {
			#src/jotun/gaming/dataform/Pulsar.hx:356: characters 4-13
			$r->arr[$r->length++] = $v;
		});
		#src/jotun/gaming/dataform/Pulsar.hx:358: characters 3-11
		return $r;
	}

	/**
	 * @param	data
	 * @return length
	 * 
	 * @param string $data
	 * 
	 * @return int
	 */
	public function parse ($data) {
		#src/jotun/gaming/dataform/Pulsar.hx:201: lines 201-288
		$_gthis = $this;
		#src/jotun/gaming/dataform/Pulsar.hx:202: lines 202-215
		if (\mb_substr($data, 0, 1) === "#") {
			#src/jotun/gaming/dataform/Pulsar.hx:203: characters 4-36
			$data = HxString::split($data, "\x0A")->join("");
			#src/jotun/gaming/dataform/Pulsar.hx:204: characters 4-43
			$key = HxString::substring($data, 1, 33);
			#src/jotun/gaming/dataform/Pulsar.hx:205: characters 4-53
			$e = \Std::parseInt(HxString::substring($data, 33, 34));
			#src/jotun/gaming/dataform/Pulsar.hx:206: characters 4-42
			$data = HxString::substring($data, 34, mb_strlen($data));
			#src/jotun/gaming/dataform/Pulsar.hx:207: lines 207-209
			if (Packager::md5Encode($data) !== $key) {
				#src/jotun/gaming/dataform/Pulsar.hx:208: characters 5-10
				throw Exception::thrown(new Error(1, "Invalid data object"));
			}
			#src/jotun/gaming/dataform/Pulsar.hx:210: lines 210-213
			while ($e > 0) {
				#src/jotun/gaming/dataform/Pulsar.hx:211: characters 5-16
				$data = ($data??'null') . "=";
				#src/jotun/gaming/dataform/Pulsar.hx:212: characters 5-8
				--$e;
			}
			#src/jotun/gaming/dataform/Pulsar.hx:214: characters 4-38
			$data = Packager::decodeBase64($data);
		}
		#src/jotun/gaming/dataform/Pulsar.hx:216: characters 3-19
		$len = 0;
		#src/jotun/gaming/dataform/Pulsar.hx:217: characters 3-42
		$i = HxString::split($data, "\x0A");
		#src/jotun/gaming/dataform/Pulsar.hx:218: characters 3-22
		$l = null;
		#src/jotun/gaming/dataform/Pulsar.hx:219: lines 219-282
		Dice::Values($i, function ($v) use (&$len, &$l, &$_gthis) {
			#src/jotun/gaming/dataform/Pulsar.hx:220: characters 4-42
			$q = HxString::split($v, " @::");
			#src/jotun/gaming/dataform/Pulsar.hx:221: characters 4-42
			$r = HxString::split(($q->arr[0] ?? null), " ");
			#src/jotun/gaming/dataform/Pulsar.hx:222: lines 222-224
			if ($q->length > 1) {
				#src/jotun/gaming/dataform/Pulsar.hx:223: characters 5-23
				$r->offsetSet($r->length, ($q->arr[1] ?? null));
			}
			#src/jotun/gaming/dataform/Pulsar.hx:225: lines 225-281
			if ($r->length > 0) {
				#src/jotun/gaming/dataform/Pulsar.hx:226: characters 5-13
				$v = ($r->arr[0] ?? null);
				#src/jotun/gaming/dataform/Pulsar.hx:227: characters 5-40
				$cmd = HxString::substring($v, 0, 1);
				#src/jotun/gaming/dataform/Pulsar.hx:228: characters 5-24
				$o = null;
				#src/jotun/gaming/dataform/Pulsar.hx:229: lines 229-280
				if ($cmd === "-") {
					#src/jotun/gaming/dataform/Pulsar.hx:252: characters 7-17
					$cmd = ($r->arr[0] ?? null);
					#src/jotun/gaming/dataform/Pulsar.hx:253: characters 7-42
					$r->offsetSet(0, HxString::substring($cmd, 1, mb_strlen($cmd)));
					#src/jotun/gaming/dataform/Pulsar.hx:254: lines 254-256
					if ($_gthis->_exists(null, $r)) {
						#src/jotun/gaming/dataform/Pulsar.hx:255: characters 8-18
						$_gthis->_delete($r);
					}
				} else if ($cmd === "/") {
					#src/jotun/gaming/dataform/Pulsar.hx:247: lines 247-249
					if ($l !== null) {
						#src/jotun/gaming/dataform/Pulsar.hx:248: characters 8-45
						$_gthis->_onObjectDelete($l->delete(($r->arr[1] ?? null), true));
					}
				} else if ($cmd === ">") {
					#src/jotun/gaming/dataform/Pulsar.hx:231: lines 231-244
					if ($l !== null) {
						#src/jotun/gaming/dataform/Pulsar.hx:232: characters 8-36
						$v = HxString::substring($v, 1, mb_strlen($v));
						#src/jotun/gaming/dataform/Pulsar.hx:233: lines 233-243
						if (($r->length === 3) && $l->exists(($r->arr[1] ?? null))) {
							#src/jotun/gaming/dataform/Pulsar.hx:234: characters 9-24
							$o = $l->get(($r->arr[1] ?? null));
							#src/jotun/gaming/dataform/Pulsar.hx:235: characters 9-22
							$o->merge(($r->arr[2] ?? null));
							#src/jotun/gaming/dataform/Pulsar.hx:236: characters 9-27
							$_gthis->_onObjectUpdate($o);
						} else {
							#src/jotun/gaming/dataform/Pulsar.hx:238: characters 9-28
							$o = Pulsar::construct($v, $r);
							#src/jotun/gaming/dataform/Pulsar.hx:239: lines 239-242
							if ($l->insert($o)) {
								#src/jotun/gaming/dataform/Pulsar.hx:240: characters 10-15
								$len += 1;
								#src/jotun/gaming/dataform/Pulsar.hx:241: characters 10-25
								$_gthis->_onObjectAdd($o);
							}
						}
					}
				} else {
					#src/jotun/gaming/dataform/Pulsar.hx:259: lines 259-278
					if ($_gthis->_exists(null, $r)) {
						#src/jotun/gaming/dataform/Pulsar.hx:260: characters 8-20
						$o = $_gthis->_grab($r);
						#src/jotun/gaming/dataform/Pulsar.hx:261: lines 261-264
						if ($r->length === 3) {
							#src/jotun/gaming/dataform/Pulsar.hx:262: characters 9-22
							$o->merge(($r->arr[2] ?? null));
							#src/jotun/gaming/dataform/Pulsar.hx:263: characters 9-25
							$_gthis->_onLinkUpdate($o);
						}
						#src/jotun/gaming/dataform/Pulsar.hx:265: characters 8-13
						$l = $o;
					} else {
						#src/jotun/gaming/dataform/Pulsar.hx:267: characters 8-27
						$o = Pulsar::construct($v, $r);
						#src/jotun/gaming/dataform/Pulsar.hx:268: lines 268-277
						if ($_gthis->insert($o)) {
							#src/jotun/gaming/dataform/Pulsar.hx:269: lines 269-271
							if ($l !== null) {
								#src/jotun/gaming/dataform/Pulsar.hx:270: characters 10-21
								$l->refresh();
							}
							#src/jotun/gaming/dataform/Pulsar.hx:272: characters 9-14
							$l = $o;
							#src/jotun/gaming/dataform/Pulsar.hx:273: characters 9-14
							$len += 1;
							#src/jotun/gaming/dataform/Pulsar.hx:274: characters 9-22
							$_gthis->_onLinkAdd($o);
						} else {
							#src/jotun/gaming/dataform/Pulsar.hx:276: characters 9-17
							$l = null;
						}
					}
				}
			}
		});
		#src/jotun/gaming/dataform/Pulsar.hx:283: lines 283-285
		if ($l !== null) {
			#src/jotun/gaming/dataform/Pulsar.hx:284: characters 4-15
			$l->refresh();
		}
		#src/jotun/gaming/dataform/Pulsar.hx:286: characters 3-12
		$this->refresh();
		#src/jotun/gaming/dataform/Pulsar.hx:287: characters 3-13
		return $len;
	}

	/**
	 * @param string $name
	 * 
	 * @return void
	 */
	public function refresh ($name = null) {
		#src/jotun/gaming/dataform/Pulsar.hx:366: lines 366-370
		Dice::Values($this->_open_links, function ($list) use (&$name) {
			#src/jotun/gaming/dataform/Pulsar.hx:367: lines 367-369
			if (($name === null) || $list->is($name)) {
				#src/jotun/gaming/dataform/Pulsar.hx:368: characters 5-19
				$list->refresh();
			}
		});
	}

	/**
	 * @return
	 * 
	 * @param bool $encode
	 * @param string $name
	 * 
	 * @return string
	 */
	public function toChangedString ($encode = null, $name = null) {
		#src/jotun/gaming/dataform/Pulsar.hx:342: characters 3-39
		return $this->_toString($encode, true, $name);
	}

	/**
	 * @return
	 * 
	 * @param bool $encode
	 * @param string $name
	 * 
	 * @return string
	 */
	public function toString ($encode = null, $name = null) {
		#src/jotun/gaming/dataform/Pulsar.hx:334: characters 3-40
		return $this->_toString($encode, false, $name);
	}

	public function __toString() {
		return $this->toString();
	}

	/**
	 * @internal
	 * @access private
	 */
	static public function __hx__init ()
	{
		static $called = false;
		if ($called) return;
		$called = true;


		self::$_dictio = new HxAnon(["*" => new HxAnon([
			"Construct" => Boot::getClass(Spark::class),
			"Properties" => null,
			"Indexable" => false,
			"Tag" => false,
		])]);
	}
}

Boot::registerClass(Pulsar::class, 'jotun.gaming.dataform.Pulsar');
Pulsar::__hx__init();
