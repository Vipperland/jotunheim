<?php
/**
 * Generated by Haxe 4.3.4
 */

namespace jotun\gaming\dataform;

use \jotun\serial\Packager;
use \php\_Boot\HxAnon;
use \jotun\tools\Key;
use \php\Boot;
use \haxe\Exception;
use \jotun\signals\Signals;
use \jotun\utils\Dice;
use \jotun\errors\Error;
use \php\_Boot\HxString;

/**
 * ...
 * @author Rim Project
 */
class Pulsar {
	/**
	 * @var int
	 */
	static public $BLOCK_SIZE = 64;
	/**
	 * @var int
	 */
	static public $ID_SIZE = 32;
	/**
	 * @var mixed
	 */
	static public $_dictio;

	/**
	 * @var mixed
	 */
	public $_open_links;
	/**
	 * @var Signals
	 */
	public $signals;

	/**
	 * @param string $name
	 * @param string[]|\Array_hx $r
	 * 
	 * @return Spark
	 */
	public static function construct ($name, $r) {
		#src/jotun/gaming/dataform/Pulsar.hx:50: characters 3-24
		$O = null;
		#src/jotun/gaming/dataform/Pulsar.hx:51: characters 3-22
		$o = null;
		#src/jotun/gaming/dataform/Pulsar.hx:52: characters 3-22
		$indexable = null;
		#src/jotun/gaming/dataform/Pulsar.hx:53: lines 53-56
		if (\Reflect::hasField(Pulsar::$_dictio, $name)) {
			#src/jotun/gaming/dataform/Pulsar.hx:54: characters 8-25
			$O = \Reflect::field(Pulsar::$_dictio, $name);
			#src/jotun/gaming/dataform/Pulsar.hx:55: characters 25-36
			$tmp = Boot::dynamicField($O, 'Construct');
			#src/jotun/gaming/dataform/Pulsar.hx:55: characters 4-43
			$o = new $tmp->phpClassName($name);
		}
		#src/jotun/gaming/dataform/Pulsar.hx:57: lines 57-67
		if ($o !== null) {
			#src/jotun/gaming/dataform/Pulsar.hx:58: lines 58-66
			if ($r->length === 3) {
				#src/jotun/gaming/dataform/Pulsar.hx:59: characters 5-16
				$o->id = ($r->arr[1] ?? null);
				#src/jotun/gaming/dataform/Pulsar.hx:60: characters 5-18
				$o->merge(($r->arr[2] ?? null));
			} else if ($r->length === 2) {
				#src/jotun/gaming/dataform/Pulsar.hx:62: lines 62-64
				if (Boot::dynamicField($O, 'Indexable')) {
					#src/jotun/gaming/dataform/Pulsar.hx:63: characters 6-29
					$o->id = Key::GEN(Pulsar::$ID_SIZE);
				}
				#src/jotun/gaming/dataform/Pulsar.hx:65: characters 5-18
				$o->merge(($r->arr[1] ?? null));
			}
		}
		#src/jotun/gaming/dataform/Pulsar.hx:68: characters 3-11
		return $o;
	}

	/**
	 * @param string $data
	 * 
	 * @return Pulsar
	 */
	public static function create ($data) {
		#src/jotun/gaming/dataform/Pulsar.hx:88: characters 3-26
		return new Pulsar($data);
	}

	/**
	 * @param mixed $data
	 * 
	 * @return string[]|\Array_hx
	 */
	public static function extract ($data) {
		#src/jotun/gaming/dataform/Pulsar.hx:80: characters 3-28
		$a = new \Array_hx();
		#src/jotun/gaming/dataform/Pulsar.hx:81: lines 81-83
		Dice::Params($data, function ($p) use (&$a) {
			#src/jotun/gaming/dataform/Pulsar.hx:82: characters 4-19
			$a->offsetSet($a->length, $p);
		});
		#src/jotun/gaming/dataform/Pulsar.hx:84: characters 3-11
		return $a;
	}

	/**
	 * @param string $name
	 * 
	 * @return bool
	 */
	public static function isIndexable ($name) {
		#src/jotun/gaming/dataform/Pulsar.hx:72: characters 10-68
		if (\Reflect::hasField(Pulsar::$_dictio, $name)) {
			#src/jotun/gaming/dataform/Pulsar.hx:72: characters 33-60
			return \Reflect::field(Pulsar::$_dictio, $name)->Indexable;
		} else {
			#src/jotun/gaming/dataform/Pulsar.hx:72: characters 63-68
			return false;
		}
	}

	/**
	 *
	 * @param	name			Pulsar object name
	 * @param	props		Object props to be mapped
	 * @param	objClass		Object Class to initialize
	 * @param	indexable		If true, generate an alphanumeric 32 length unique ID for each instance
	 * 
	 * @param string $name
	 * @param mixed $props
	 * @param mixed $objClass
	 * @param bool $indexable
	 * 
	 * @return void
	 */
	public static function map ($name, $props, $objClass = null, $indexable = false) {
		#src/jotun/gaming/dataform/Pulsar.hx:42: lines 42-46
		if ($indexable === null) {
			$indexable = false;
		}
		$value = new HxAnon([
			"Construct" => ($objClass === null ? Boot::getClass(Spark::class) : $objClass),
			"Properties" => ($props === null ? null : $props),
			"Indexable" => $indexable === true,
		]);
		\Reflect::setField(Pulsar::$_dictio, $name, $value);
	}

	/**
	 * @param string $name
	 * 
	 * @return string[]|\Array_hx
	 */
	public static function propertiesOf ($name) {
		#src/jotun/gaming/dataform/Pulsar.hx:76: characters 10-68
		if (\Reflect::hasField(Pulsar::$_dictio, $name)) {
			#src/jotun/gaming/dataform/Pulsar.hx:76: characters 33-61
			return \Reflect::field(Pulsar::$_dictio, $name)->Properties;
		} else {
			#src/jotun/gaming/dataform/Pulsar.hx:76: characters 64-68
			return null;
		}
	}

	/**
	 * @param string $data
	 * 
	 * @return void
	 */
	public function __construct ($data = null) {
		#src/jotun/gaming/dataform/Pulsar.hx:164: characters 3-19
		$this->_open_links = new HxAnon();
		#src/jotun/gaming/dataform/Pulsar.hx:165: characters 3-30
		$this->signals = new Signals($this);
		#src/jotun/gaming/dataform/Pulsar.hx:166: lines 166-168
		if (($data !== null) && (mb_strlen($data) > 0)) {
			#src/jotun/gaming/dataform/Pulsar.hx:167: characters 4-15
			$this->parse($data);
		}
	}

	/**
	 * @param string[]|\Array_hx $r
	 * 
	 * @return void
	 */
	public function _delete ($r) {
		#src/jotun/gaming/dataform/Pulsar.hx:123: lines 123-128
		if ($r->length === 2) {
			#src/jotun/gaming/dataform/Pulsar.hx:124: characters 4-34
			$x = $this->link(($r->arr[0] ?? null));
			#src/jotun/gaming/dataform/Pulsar.hx:125: lines 125-127
			if ($x !== null) {
				#src/jotun/gaming/dataform/Pulsar.hx:126: characters 5-40
				$this->_onLinkDelete($x->delete(($r->arr[1] ?? null), true));
			}
		}
	}

	/**
	 * @param string $r
	 * 
	 * @return string
	 */
	public function _encode ($r) {
		#src/jotun/gaming/dataform/Pulsar.hx:288: characters 3-31
		$r = Packager::encodeBase64($r);
		#src/jotun/gaming/dataform/Pulsar.hx:289: characters 3-17
		$i = 0;
		#src/jotun/gaming/dataform/Pulsar.hx:290: lines 290-293
		while (\mb_substr($r, mb_strlen($r) - 1, 1) === "=") {
			#src/jotun/gaming/dataform/Pulsar.hx:291: characters 4-36
			$r = HxString::substring($r, 0, mb_strlen($r) - 1);
			#src/jotun/gaming/dataform/Pulsar.hx:292: characters 4-7
			++$i;
		}
		#src/jotun/gaming/dataform/Pulsar.hx:294: characters 3-42
		$r = "#" . (Packager::md5Encode($r)??'null') . ($i??'null') . ($r??'null');
		#src/jotun/gaming/dataform/Pulsar.hx:295: characters 3-8
		$i = 0;
		#src/jotun/gaming/dataform/Pulsar.hx:296: characters 3-22
		$nr = "";
		#src/jotun/gaming/dataform/Pulsar.hx:297: characters 3-26
		$len = mb_strlen($r);
		#src/jotun/gaming/dataform/Pulsar.hx:298: lines 298-301
		while ($i < $len) {
			#src/jotun/gaming/dataform/Pulsar.hx:299: characters 4-40
			$nr = ($nr??'null') . (\mb_substr($r, $i, Pulsar::$BLOCK_SIZE)??'null') . "\x0A";
			#src/jotun/gaming/dataform/Pulsar.hx:300: characters 4-19
			$i += Pulsar::$BLOCK_SIZE;
		}
		#src/jotun/gaming/dataform/Pulsar.hx:302: characters 3-38
		return HxString::substring($nr, 0, mb_strlen($nr) - 1);
	}

	/**
	 * @param Spark $o
	 * @param string[]|\Array_hx $r
	 * 
	 * @return bool
	 */
	public function _exists ($o, $r) {
		#src/jotun/gaming/dataform/Pulsar.hx:103: lines 103-108
		if ($r->length >= 2) {
			#src/jotun/gaming/dataform/Pulsar.hx:104: characters 4-34
			$x = $this->link(($r->arr[0] ?? null));
			#src/jotun/gaming/dataform/Pulsar.hx:105: lines 105-107
			if ($x !== null) {
				#src/jotun/gaming/dataform/Pulsar.hx:106: characters 5-26
				return $x->exists(($r->arr[1] ?? null));
			}
		}
		#src/jotun/gaming/dataform/Pulsar.hx:109: characters 3-15
		return false;
	}

	/**
	 * @param string $name
	 * 
	 * @return PulsarLink
	 */
	public function _getOrCreate ($name) {
		#src/jotun/gaming/dataform/Pulsar.hx:94: characters 3-44
		$x = \Reflect::field($this->_open_links, $name);
		#src/jotun/gaming/dataform/Pulsar.hx:95: lines 95-98
		if ($x === null) {
			#src/jotun/gaming/dataform/Pulsar.hx:96: characters 4-28
			$x = new PulsarLink($name);
			#src/jotun/gaming/dataform/Pulsar.hx:97: characters 4-28
			\Reflect::setField($this->_open_links, $name, $x);
		}
		#src/jotun/gaming/dataform/Pulsar.hx:99: characters 3-11
		return $x;
	}

	/**
	 * @param string[]|\Array_hx $r
	 * 
	 * @return Spark
	 */
	public function _grab ($r) {
		#src/jotun/gaming/dataform/Pulsar.hx:113: lines 113-118
		if ($r->length >= 2) {
			#src/jotun/gaming/dataform/Pulsar.hx:114: characters 4-34
			$x = $this->link(($r->arr[0] ?? null));
			#src/jotun/gaming/dataform/Pulsar.hx:115: lines 115-117
			if ($x !== null) {
				#src/jotun/gaming/dataform/Pulsar.hx:116: characters 5-23
				return $x->get(($r->arr[1] ?? null));
			}
		}
		#src/jotun/gaming/dataform/Pulsar.hx:119: characters 3-14
		return null;
	}

	/**
	 * @param Spark $o
	 * 
	 * @return void
	 */
	public function _onLinkAdd ($o) {
		#src/jotun/gaming/dataform/Pulsar.hx:132: characters 3-46
		$this->signals->call(PulsarSignals::$LINK_CREATED, $o);
	}

	/**
	 * @param Spark $o
	 * 
	 * @return void
	 */
	public function _onLinkDelete ($o) {
		#src/jotun/gaming/dataform/Pulsar.hx:142: characters 3-46
		$this->signals->call(PulsarSignals::$LINK_DELETED, $o);
	}

	/**
	 * @param Spark $o
	 * 
	 * @return void
	 */
	public function _onLinkUpdate ($o) {
		#src/jotun/gaming/dataform/Pulsar.hx:152: characters 3-46
		$this->signals->call(PulsarSignals::$LINK_UPDATED, $o);
	}

	/**
	 * @param Spark $o
	 * 
	 * @return void
	 */
	public function _onObjectAdd ($o) {
		#src/jotun/gaming/dataform/Pulsar.hx:136: lines 136-138
		if ($o !== null) {
			#src/jotun/gaming/dataform/Pulsar.hx:137: characters 4-48
			$this->signals->call(PulsarSignals::$SPARK_CREATED, $o);
		}
	}

	/**
	 * @param Spark $o
	 * 
	 * @return void
	 */
	public function _onObjectDelete ($o) {
		#src/jotun/gaming/dataform/Pulsar.hx:146: lines 146-148
		if ($o !== null) {
			#src/jotun/gaming/dataform/Pulsar.hx:147: characters 4-48
			$this->signals->call(PulsarSignals::$SPARK_DELETED, $o);
		}
	}

	/**
	 * @param Spark $o
	 * 
	 * @return void
	 */
	public function _onObjectUpdate ($o) {
		#src/jotun/gaming/dataform/Pulsar.hx:156: lines 156-158
		if ($o !== null) {
			#src/jotun/gaming/dataform/Pulsar.hx:157: characters 4-48
			$this->signals->call(PulsarSignals::$SPARK_UPDATED, $o);
		}
	}

	/**
	 * @param bool $encode
	 * @param bool $changes
	 * @param string $name
	 * 
	 * @return string
	 */
	public function _toString ($encode = null, $changes = null, $name = null) {
		#src/jotun/gaming/dataform/Pulsar.hx:306: characters 3-21
		$r = "";
		#src/jotun/gaming/dataform/Pulsar.hx:307: characters 3-23
		$c = null;
		#src/jotun/gaming/dataform/Pulsar.hx:308: lines 308-319
		Dice::Values($this->_open_links, function ($list) use (&$name, &$c, &$changes, &$r) {
			#src/jotun/gaming/dataform/Pulsar.hx:309: lines 309-318
			if (($name === null) || $list->is($name)) {
				#src/jotun/gaming/dataform/Pulsar.hx:311: characters 5-32
				$c = $list->stringify($changes);
				#src/jotun/gaming/dataform/Pulsar.hx:312: lines 312-317
				if ($c !== null) {
					#src/jotun/gaming/dataform/Pulsar.hx:313: lines 313-315
					if (mb_strlen($r) > 0) {
						#src/jotun/gaming/dataform/Pulsar.hx:314: characters 7-16
						$r = ($r??'null') . "\x0A";
					}
					#src/jotun/gaming/dataform/Pulsar.hx:316: characters 6-12
					$r = ($r??'null') . ($c??'null');
				}
			}
		});
		#src/jotun/gaming/dataform/Pulsar.hx:320: lines 320-322
		if ($encode) {
			#src/jotun/gaming/dataform/Pulsar.hx:321: characters 4-18
			$r = $this->_encode($r);
		}
		#src/jotun/gaming/dataform/Pulsar.hx:323: characters 3-11
		return $r;
	}

	/**
	 * @return Pulsar
	 */
	public function clone () {
		#src/jotun/gaming/dataform/Pulsar.hx:377: characters 3-31
		$o = new Pulsar();
		#src/jotun/gaming/dataform/Pulsar.hx:378: characters 3-27
		$o->parse($this->toString(false));
		#src/jotun/gaming/dataform/Pulsar.hx:379: characters 3-11
		return $o;
	}

	/**
	 * @return void
	 */
	public function commit () {
		#src/jotun/gaming/dataform/Pulsar.hx:371: lines 371-373
		Dice::Values($this->_open_links, function ($list) {
			#src/jotun/gaming/dataform/Pulsar.hx:372: characters 4-17
			$list->commit();
		});
	}

	/**
	 * @param \Closure $handler
	 * 
	 * @return void
	 */
	public function each ($handler) {
		#src/jotun/gaming/dataform/Pulsar.hx:359: characters 3-36
		Dice::Values($this->_open_links, $handler);
	}

	/**
	 * @param string $name
	 * 
	 * @return bool
	 */
	public function exists ($name) {
		#src/jotun/gaming/dataform/Pulsar.hx:343: characters 10-34
		return \Reflect::hasField($this->_open_links, $name);
	}

	/**
	 * @return mixed
	 */
	public function getObject () {
		#src/jotun/gaming/dataform/Pulsar.hx:383: characters 3-40
		$r = new HxAnon();
		#src/jotun/gaming/dataform/Pulsar.hx:384: lines 384-390
		Dice::All($this->_open_links, function ($p, $v) use (&$r) {
			#src/jotun/gaming/dataform/Pulsar.hx:385: lines 385-389
			if (!\Reflect::hasField($r, $p)) {
				#src/jotun/gaming/dataform/Pulsar.hx:386: characters 5-52
				$value = $v->getObject(($v->isSingle() ? null : new \Array_hx()));
				\Reflect::setField($r, $p, $value);
			} else {
				#src/jotun/gaming/dataform/Pulsar.hx:388: characters 5-31
				$v->getObject(\Reflect::field($r, $p));
			}
		});
		#src/jotun/gaming/dataform/Pulsar.hx:391: characters 3-11
		return $r;
	}

	/**
	 * @param	o
	 * @return
	 * 
	 * @param Spark $o
	 * 
	 * @return bool
	 */
	public function insert ($o) {
		#src/jotun/gaming/dataform/Pulsar.hx:177: characters 3-33
		$name = $o->getName();
		#src/jotun/gaming/dataform/Pulsar.hx:178: lines 178-189
		if (($name !== null) && (mb_strlen($name) > 0)) {
			#src/jotun/gaming/dataform/Pulsar.hx:179: characters 4-42
			$x = $this->_getOrCreate($name);
			#src/jotun/gaming/dataform/Pulsar.hx:181: lines 181-185
			if (Pulsar::isIndexable($name)) {
				#src/jotun/gaming/dataform/Pulsar.hx:182: lines 182-184
				while (($o->id === null) && !$x->exists($o->id)) {
					#src/jotun/gaming/dataform/Pulsar.hx:183: characters 6-29
					$o->id = Key::GEN(Pulsar::$ID_SIZE);
				}
			}
			#src/jotun/gaming/dataform/Pulsar.hx:186: characters 4-15
			$x->insert($o);
		} else {
			#src/jotun/gaming/dataform/Pulsar.hx:188: characters 4-12
			$o = null;
		}
		#src/jotun/gaming/dataform/Pulsar.hx:190: characters 3-19
		return $o !== null;
	}

	/**
	 * @param string $name
	 * 
	 * @return PulsarLink
	 */
	public function link ($name) {
		#src/jotun/gaming/dataform/Pulsar.hx:347: characters 3-28
		return $this->_getOrCreate($name);
	}

	/**
	 * @return PulsarLink[]|\Array_hx
	 */
	public function links () {
		#src/jotun/gaming/dataform/Pulsar.hx:351: characters 3-32
		$r = new \Array_hx();
		#src/jotun/gaming/dataform/Pulsar.hx:352: lines 352-354
		Dice::Values($this->_open_links, function ($v) use (&$r) {
			#src/jotun/gaming/dataform/Pulsar.hx:353: characters 4-13
			$r->arr[$r->length++] = $v;
		});
		#src/jotun/gaming/dataform/Pulsar.hx:355: characters 3-11
		return $r;
	}

	/**
	 * @param	data
	 * @return length
	 * 
	 * @param string $data
	 * 
	 * @return int
	 */
	public function parse ($data) {
		#src/jotun/gaming/dataform/Pulsar.hx:198: lines 198-285
		$_gthis = $this;
		#src/jotun/gaming/dataform/Pulsar.hx:199: lines 199-212
		if (\mb_substr($data, 0, 1) === "#") {
			#src/jotun/gaming/dataform/Pulsar.hx:200: characters 4-36
			$data = HxString::split($data, "\x0A")->join("");
			#src/jotun/gaming/dataform/Pulsar.hx:201: characters 4-43
			$key = HxString::substring($data, 1, 33);
			#src/jotun/gaming/dataform/Pulsar.hx:202: characters 4-53
			$e = \Std::parseInt(HxString::substring($data, 33, 34));
			#src/jotun/gaming/dataform/Pulsar.hx:203: characters 4-42
			$data = HxString::substring($data, 34, mb_strlen($data));
			#src/jotun/gaming/dataform/Pulsar.hx:204: lines 204-206
			if (Packager::md5Encode($data) !== $key) {
				#src/jotun/gaming/dataform/Pulsar.hx:205: characters 5-10
				throw Exception::thrown(new Error(1, "Invalid data object"));
			}
			#src/jotun/gaming/dataform/Pulsar.hx:207: lines 207-210
			while ($e > 0) {
				#src/jotun/gaming/dataform/Pulsar.hx:208: characters 5-16
				$data = ($data??'null') . "=";
				#src/jotun/gaming/dataform/Pulsar.hx:209: characters 5-8
				--$e;
			}
			#src/jotun/gaming/dataform/Pulsar.hx:211: characters 4-38
			$data = Packager::decodeBase64($data);
		}
		#src/jotun/gaming/dataform/Pulsar.hx:213: characters 3-19
		$len = 0;
		#src/jotun/gaming/dataform/Pulsar.hx:214: characters 3-42
		$i = HxString::split($data, "\x0A");
		#src/jotun/gaming/dataform/Pulsar.hx:215: characters 3-22
		$l = null;
		#src/jotun/gaming/dataform/Pulsar.hx:216: lines 216-279
		Dice::Values($i, function ($v) use (&$len, &$l, &$_gthis) {
			#src/jotun/gaming/dataform/Pulsar.hx:217: characters 4-42
			$q = HxString::split($v, " @::");
			#src/jotun/gaming/dataform/Pulsar.hx:218: characters 4-42
			$r = HxString::split(($q->arr[0] ?? null), " ");
			#src/jotun/gaming/dataform/Pulsar.hx:219: lines 219-221
			if ($q->length > 1) {
				#src/jotun/gaming/dataform/Pulsar.hx:220: characters 5-23
				$r->offsetSet($r->length, ($q->arr[1] ?? null));
			}
			#src/jotun/gaming/dataform/Pulsar.hx:222: lines 222-278
			if ($r->length > 0) {
				#src/jotun/gaming/dataform/Pulsar.hx:223: characters 5-13
				$v = ($r->arr[0] ?? null);
				#src/jotun/gaming/dataform/Pulsar.hx:224: characters 5-40
				$cmd = HxString::substring($v, 0, 1);
				#src/jotun/gaming/dataform/Pulsar.hx:225: characters 5-24
				$o = null;
				#src/jotun/gaming/dataform/Pulsar.hx:226: lines 226-277
				if ($cmd === "-") {
					#src/jotun/gaming/dataform/Pulsar.hx:249: characters 7-17
					$cmd = ($r->arr[0] ?? null);
					#src/jotun/gaming/dataform/Pulsar.hx:250: characters 7-42
					$r->offsetSet(0, HxString::substring($cmd, 1, mb_strlen($cmd)));
					#src/jotun/gaming/dataform/Pulsar.hx:251: lines 251-253
					if ($_gthis->_exists(null, $r)) {
						#src/jotun/gaming/dataform/Pulsar.hx:252: characters 8-18
						$_gthis->_delete($r);
					}
				} else if ($cmd === "/") {
					#src/jotun/gaming/dataform/Pulsar.hx:244: lines 244-246
					if ($l !== null) {
						#src/jotun/gaming/dataform/Pulsar.hx:245: characters 8-45
						$_gthis->_onObjectDelete($l->delete(($r->arr[1] ?? null), true));
					}
				} else if ($cmd === ">") {
					#src/jotun/gaming/dataform/Pulsar.hx:228: lines 228-241
					if ($l !== null) {
						#src/jotun/gaming/dataform/Pulsar.hx:229: characters 8-36
						$v = HxString::substring($v, 1, mb_strlen($v));
						#src/jotun/gaming/dataform/Pulsar.hx:230: lines 230-240
						if (($r->length === 3) && $l->exists(($r->arr[1] ?? null))) {
							#src/jotun/gaming/dataform/Pulsar.hx:231: characters 9-24
							$o = $l->get(($r->arr[1] ?? null));
							#src/jotun/gaming/dataform/Pulsar.hx:232: characters 9-22
							$o->merge(($r->arr[2] ?? null));
							#src/jotun/gaming/dataform/Pulsar.hx:233: characters 9-27
							$_gthis->_onObjectUpdate($o);
						} else {
							#src/jotun/gaming/dataform/Pulsar.hx:235: characters 9-28
							$o = Pulsar::construct($v, $r);
							#src/jotun/gaming/dataform/Pulsar.hx:236: lines 236-239
							if ($l->insert($o)) {
								#src/jotun/gaming/dataform/Pulsar.hx:237: characters 10-15
								$len += 1;
								#src/jotun/gaming/dataform/Pulsar.hx:238: characters 10-25
								$_gthis->_onObjectAdd($o);
							}
						}
					}
				} else {
					#src/jotun/gaming/dataform/Pulsar.hx:256: lines 256-275
					if ($_gthis->_exists(null, $r)) {
						#src/jotun/gaming/dataform/Pulsar.hx:257: characters 8-20
						$o = $_gthis->_grab($r);
						#src/jotun/gaming/dataform/Pulsar.hx:258: lines 258-261
						if ($r->length === 3) {
							#src/jotun/gaming/dataform/Pulsar.hx:259: characters 9-22
							$o->merge(($r->arr[2] ?? null));
							#src/jotun/gaming/dataform/Pulsar.hx:260: characters 9-25
							$_gthis->_onLinkUpdate($o);
						}
						#src/jotun/gaming/dataform/Pulsar.hx:262: characters 8-13
						$l = $o;
					} else {
						#src/jotun/gaming/dataform/Pulsar.hx:264: characters 8-27
						$o = Pulsar::construct($v, $r);
						#src/jotun/gaming/dataform/Pulsar.hx:265: lines 265-274
						if ($_gthis->insert($o)) {
							#src/jotun/gaming/dataform/Pulsar.hx:266: lines 266-268
							if ($l !== null) {
								#src/jotun/gaming/dataform/Pulsar.hx:267: characters 10-21
								$l->refresh();
							}
							#src/jotun/gaming/dataform/Pulsar.hx:269: characters 9-14
							$l = $o;
							#src/jotun/gaming/dataform/Pulsar.hx:270: characters 9-14
							$len += 1;
							#src/jotun/gaming/dataform/Pulsar.hx:271: characters 9-22
							$_gthis->_onLinkAdd($o);
						} else {
							#src/jotun/gaming/dataform/Pulsar.hx:273: characters 9-17
							$l = null;
						}
					}
				}
			}
		});
		#src/jotun/gaming/dataform/Pulsar.hx:280: lines 280-282
		if ($l !== null) {
			#src/jotun/gaming/dataform/Pulsar.hx:281: characters 4-15
			$l->refresh();
		}
		#src/jotun/gaming/dataform/Pulsar.hx:283: characters 3-12
		$this->refresh();
		#src/jotun/gaming/dataform/Pulsar.hx:284: characters 3-13
		return $len;
	}

	/**
	 * @param string $name
	 * 
	 * @return void
	 */
	public function refresh ($name = null) {
		#src/jotun/gaming/dataform/Pulsar.hx:363: lines 363-367
		Dice::Values($this->_open_links, function ($list) use (&$name) {
			#src/jotun/gaming/dataform/Pulsar.hx:364: lines 364-366
			if (($name === null) || $list->is($name)) {
				#src/jotun/gaming/dataform/Pulsar.hx:365: characters 5-19
				$list->refresh();
			}
		});
	}

	/**
	 * @return
	 * 
	 * @param bool $encode
	 * @param string $name
	 * 
	 * @return string
	 */
	public function toChangedString ($encode = null, $name = null) {
		#src/jotun/gaming/dataform/Pulsar.hx:339: characters 3-39
		return $this->_toString($encode, true, $name);
	}

	/**
	 * @return
	 * 
	 * @param bool $encode
	 * @param string $name
	 * 
	 * @return string
	 */
	public function toString ($encode = null, $name = null) {
		#src/jotun/gaming/dataform/Pulsar.hx:331: characters 3-40
		return $this->_toString($encode, false, $name);
	}

	public function __toString() {
		return $this->toString();
	}

	/**
	 * @internal
	 * @access private
	 */
	static public function __hx__init ()
	{
		static $called = false;
		if ($called) return;
		$called = true;


		self::$_dictio = new HxAnon(["*" => new HxAnon([
			"Construct" => Boot::getClass(Spark::class),
			"Properties" => null,
			"Indexable" => false,
			"Tag" => false,
		])]);
	}
}

Boot::registerClass(Pulsar::class, 'jotun.gaming.dataform.Pulsar');
Pulsar::__hx__init();
