<?php
/**
 * Generated by Haxe 4.3.6
 */

namespace jotun\utils;

use \jotun\serial\Packager;
use \jotun\tools\Key;
use \php\Boot;
use \jotun\math\JMath;
use \php\_Boot\HxString;

/**
 * ...
 * @author
 */
class Omnitools {
	/**
	 * Conver a DD/MM/AAAA date format to unixtime
	 * @param	date
	 * @return
	 * 
	 * @param string $date
	 * 
	 * @return float
	 */
	public static function dmYToUnixtime ($date) {
		#src/jotun/utils/Omnitools.hx:69: lines 69-78
		if (($date !== null) && (mb_strlen($date) === 10)) {
			#src/jotun/utils/Omnitools.hx:70: characters 4-66
			$darr = HxString::split(HxString::split($date, "/")->join("-"), "-");
			#src/jotun/utils/Omnitools.hx:71: lines 71-73
			if (mb_strlen(($darr->arr[0] ?? null)) !== 4) {
				#src/jotun/utils/Omnitools.hx:72: characters 5-19
				$darr->arr = \array_reverse($darr->arr);
			}
			#src/jotun/utils/Omnitools.hx:74: characters 4-25
			$date = $darr->join("-");
			#src/jotun/utils/Omnitools.hx:75: characters 4-42
			return \Date::fromString($date)->getTime();
		} else {
			#src/jotun/utils/Omnitools.hx:77: characters 4-12
			return 0;
		}
	}

	/**
	 * Create a unique random 32 length string
	 * @return
	 * 
	 * @return string
	 */
	public static function genRandomIDx32 () {
		#src/jotun/utils/Omnitools.hx:43: characters 3-59
		return Packager::md5Encode((Key::GEN(16)??'null') . "." . (Omnitools::timeNow()??'null'));
	}

	/**
	 * Create a unique random 32 length string
	 * @return
	 * 
	 * @return string
	 */
	public static function genRandomIDx65 () {
		#src/jotun/utils/Omnitools.hx:35: characters 3-79
		return (Packager::md5Encode(Key::GEN(32))??'null') . "." . (Packager::md5Encode(Omnitools::timeNow())??'null');
	}

	/**
	 * @param string $pwd
	 * 
	 * @return string
	 */
	public static function generatePwdHash ($pwd) {
		#src/jotun/utils/Omnitools.hx:47: characters 3-70
		return password_hash($pwd, PASSWORD_BCRYPT);
	}

	/**
	 * If elapsed date is greater or equal to 18 years
	 * @param	time
	 * @return
	 * 
	 * @param float $time
	 * 
	 * @return bool
	 */
	public static function testBirthdate ($time) {
		#src/jotun/utils/Omnitools.hx:60: characters 3-35
		return JMath::calcAge($time) >= 18;
	}

	/**
	 * Servertime + hours offset
	 * @param	hours
	 * @return
	 * 
	 * @param float $hours
	 * @param bool $ms
	 * 
	 * @return float
	 */
	public static function timeFromNow ($hours, $ms = null) {
		#src/jotun/utils/Omnitools.hx:27: characters 3-39
		return Omnitools::timeNow() + $hours * 3600000;
	}

	/**
	 * Servertime
	 * @return
	 * 
	 * @return float
	 */
	public static function timeNow () {
		#src/jotun/utils/Omnitools.hx:18: characters 3-30
		return \Date::now()->getTime();
	}

	/**
	 * @param string $pwd
	 * @param string $hash
	 * 
	 * @return bool
	 */
	public static function verifyPwdHash ($pwd, $hash) {
		#src/jotun/utils/Omnitools.hx:51: characters 3-73
		return password_verify($pwd, $hash) === $pwd;
	}
}

Boot::registerClass(Omnitools::class, 'jotun.utils.Omnitools');
