<?php
/**
 * Generated by Haxe 4.3.0
 */

namespace jotun\gateway\database;

use \php\Boot;
use \jotun\gateway\domain\Output;
use \jotun\Jotun;
use \jotun\php\db\Token;
use \jotun\php\db\objects\IDataTable;

/**
 * ...
 * @author
 */
class DataAccess {
	/**
	 * @var DataAccess
	 */
	static public $_instance;

	/**
	 * @var IDataTable
	 */
	public $user_session;

	/**
	 * @param mixed $handler
	 * 
	 * @return mixed
	 */
	public static function execute ($handler) {
		#server/jotun/gateway/database/DataAccess.hx:24: lines 24-26
		if (DataAccess::$_instance !== null) {
			#server/jotun/gateway/database/DataAccess.hx:25: characters 4-20
			return $handler();
		}
		#server/jotun/gateway/database/DataAccess.hx:27: characters 3-51
		Output::get_ME()->error(101);
		#server/jotun/gateway/database/DataAccess.hx:28: characters 3-15
		return null;
	}

	/**
	 * @return DataAccess
	 */
	public static function getInstance () {
		#server/jotun/gateway/database/DataAccess.hx:20: characters 3-19
		return DataAccess::$_instance;
	}

	/**
	 * @param Token $token
	 * 
	 * @return void
	 */
	public function __construct ($token) {
		#server/jotun/gateway/database/DataAccess.hx:36: lines 36-38
		if (DataAccess::$_instance !== null) {
			#server/jotun/gateway/database/DataAccess.hx:37: characters 4-9
			throw new \ErrorException("DataAccess is a Singleton");
		}
		#server/jotun/gateway/database/DataAccess.hx:39: characters 3-19
		DataAccess::$_instance = $this;
		#server/jotun/gateway/database/DataAccess.hx:40: lines 40-44
		if (!Jotun::$gate->isOpen()) {
			#server/jotun/gateway/database/DataAccess.hx:41: lines 41-43
			if (!Jotun::$gate->open($token)->isOpen()) {
				#server/jotun/gateway/database/DataAccess.hx:42: characters 5-46
				$this->_error(100);
			}
		}
	}

	/**
	 * @param int $code
	 * 
	 * @return void
	 */
	public function _error ($code) {
		#server/jotun/gateway/database/DataAccess.hx:32: characters 3-24
		Output::get_ME()->error($code);
	}

	/**
	 * @param string $table
	 * @param mixed $Def
	 * 
	 * @return IDataTable
	 */
	public function _tryAssemble ($table, $Def) {
		#server/jotun/gateway/database/DataAccess.hx:52: lines 52-61
		return DataAccess::execute(function () use (&$table, &$Def) {
			#server/jotun/gateway/database/DataAccess.hx:53: characters 4-51
			$table1 = Jotun::$gate->table($table);
			#server/jotun/gateway/database/DataAccess.hx:54: lines 54-60
			if ($table1 !== null) {
				#server/jotun/gateway/database/DataAccess.hx:55: characters 5-27
				$table1->setClassObj($Def);
				#server/jotun/gateway/database/DataAccess.hx:56: characters 5-17
				return $table1;
			} else {
				#server/jotun/gateway/database/DataAccess.hx:58: characters 5-55
				Output::get_ME()->error(102);
				#server/jotun/gateway/database/DataAccess.hx:59: characters 5-17
				return null;
			}
		});
	}

	/**
	 * @return IDataTable
	 */
	public function get_user_session () {
		#server/jotun/gateway/database/DataAccess.hx:66: characters 3-27
		return $this->user_session;
	}

	/**
	 * @return bool
	 */
	public function isConnected () {
		#server/jotun/gateway/database/DataAccess.hx:48: characters 3-27
		return DataAccess::$_instance !== null;
	}
}

Boot::registerClass(DataAccess::class, 'jotun.gateway.database.DataAccess');
Boot::registerGetters('jotun\\gateway\\database\\DataAccess', [
	'user_session' => true
]);
