[Module:{"name":"sru-logger-data"}]
	<div class="logger-sruobj" hidden>{{data}}</div>
[Module:{"name":"sru-logger-ticket"}]
	<div id="{{id}}" class="logger-nowrap {{bg}}">
		<span class="tick" style="color:#666666">[{{tick}}]</span>
		<span class="info">{{data}}</span>
	</div>
[Module:{"name":"sru-logger-container"}]
	<div id="sirius-log">SIRIUS LOGGER</div>
	<div class="logger-container">
		<div id="sirius-dump">
		</div>
	</div>
[Module:{"version":1.0,"type":"style"}]
	<style>
		#sirius-log {
			cursor:pointer;
			padding: 5px;
			background: #222222;
		}
		.logger-container{
			max-height: calc(100vh - 25px);
			overflow-y: auto
		}
		.logger-console {
			font-family: Lucida Console;
			font-size: 10px;
			color: #FFFFFF;
			background-color: rgba(0,0,0,.9);
			min-width: 350px;
			max-width: 800px;
			top: 0;
			overflow: none;
			position: fixed;
			z-index: 9999999;
		}
		.logger-nowrap {
			white-space: nowrap;
			overflow-x: hidden;
		}
		.logger-sruobj {
			color: #FFFFFF;
			padding: 10px;
			background-color: rgba(255,255,255,.1);
		}
		.logger-data {
			color: #FFFFFF;
			cursor: pointer;
		}
		.logger-closed {
			height: 25px;
		}
	</style>
[Module:{"version":1.0,"type":"script"}]
	<script>
		
		Sirius.logger.mute();
		
		var t = new sru.dom.Div();
		var l = 0;
		var c = false;
		var mv = 0;
		var cr = {x:0,y:0};
		t.css('logger-console');
		t.addToBody();
		t.mount('sru-logger-container');
		
		var d = t.one('#sirius-dump');
		_bgs = ['txt-xCCCCCC','txt-x00CCFF','txt-xFFFF00','txt-xFF0000','txt-xFF99CC bold', 'txt-x0099CC'];
		
		Automator.build('bg-x000000 padd-5 bg-xFFFFFF bg-x10FFFFFF padd-t-5 min-w-350 max-w-700 padd-l-50 pos-fix h-30');
		Automator.build(_bgs.join(' '));
		
		function stringIfObject(o) {
		  return o === Object(o) ? JSON.stringify(o) : o;
		}
		
		function _push(data, type, id){
			if(type < 0) type = 0;
			else if(type > 4) type = 0;
			var s = (l++) + '';
			while(s.length < 5) s = '·' + s;
			d.mount('sru-logger-ticket',{id:id, tick:s,data: stringIfObject(data), bg:_bgs[type]});
			return s;
		}
		
		var xhr = {};
		
		function _expl(e){
			var tip = e.target.data.tip;
			if(tip.element.hidden) tip.show();
			else tip.hide();
		}
		function _updateXHR(v){
			var e = Sirius.one('#' + v.id).one('.tick');
			var p = '';
			while(p.length < 5) p = p + (v.ct == p.length ? '|' : '·');
			e.clear(true).write('['+p+']');
			if(++v.ct > 5) v.ct = 0;
		}
		
		function xhr_render(){
			Dice.Values(xhr, _updateXHR);
		}
		
		function _listen(flow){
			var req = flow.data.request;
			var url = flow.data.file;
			var stat = flow.pipe.name;
			var data = flow.data.data;
			switch(flow.pipe.name){
				case 'started' : {
					req.id = 'xhr_' + sru.tools.Key.GEN();
					req.time = new Date().getTime();
					req.ct = 0;
					req.bs = _push('Resource &lt;= ' + url + ' <span class="status">(LOADING...)</span>', 1, req.id);
					req.sent = data;
					xhr[req.id] = req;
					break;
				}
				case 'loaded' :
				case 'complete' : {
					if(req.id != null) {
						var e = Sirius.one('#' + req.id);
						var v = e.one('.status');
						v.clear(true).write('(COMPLETE @' + (new Date().getTime() - req.time) + 'ms)<span class="logger-data"></span>');
						e.one('.tick').clear(true).write('['+req.bs+']');
						e.css('/txt-x00FF66 txt-x0099CC bg-x000000');
						if(data != null){
							var o = null;
							try {
								o = JSON.parse(data);
							}catch(er){ /* NOT A JSON */ }
							if(o != null){
								var ac = new sru.dom.Div();
								ac.mount('sru-logger-data', {data:Utils.sruString({received:o, sent:req.sent}).split('\r').join('<br/>').split(' ').join('&nbsp;')});
								e.addChild(ac);
								var sp = e.one('.logger-data');
								sp.initData();
								sp.data.tip = ac.one('.logger-sruobj');
								sp.write('[VIEW]');
								sp.events.click(_expl);
							}
						}
						delete xhr[req.id];
					}
					break;
				}
				case 'error' : {
					if(req.id != null) {
						var e = Sirius.one('#' + req.id);
						e.css('/txt-x00FF66 txt-xFF6600');
						e.one('.status').clear(true).write('(ERROR!)');
						delete xhr[req.id];
					}
					break;
				}
			}
		}
		function _toggle(e){
			if(mv > 10) return;
			c = !c;
			if(c){
				d.hide();
				t.css('logger-closed');
			}else {
				d.show();
				t.css('/logger-closed');
			}
			t.style({
				top:0+'px',
				left:0+'px'
			});
		}
		function _seek(e){
			++mv;
			var x = e.event.clientX-cr.x;
			var y = e.event.clientY-cr.y;
			t.style({
				top:y+'px',
				left:x+'px'
			});
		}
		function _undrag(e){
			Sirius.document.body.events.mouseMove(_seek,-1);
			Sirius.document.body.events.mouseUp(_undrag,-1);
		}
		function _drag(e){
			mv = 0;
			var b = t.getBounds();
			cr = {x:e.event.clientX-b.left,y:e.event.clientY-b.top}
			Sirius.document.body.events.mouseMove(_seek);
			Sirius.document.body.events.mouseUp(_undrag);
		}
		setInterval(xhr_render, 100);
		Sirius.one('#sirius-log').events.click(_toggle, 1);
		Sirius.one('#sirius-log').events.mouseDown(_drag, 1);
		Sirius.loader.signals.add('started',_listen);
		Sirius.loader.signals.add('loaded',_listen);
		Sirius.loader.signals.add('error',_listen);
		Sirius.logger.listen(_push);
		
	</script>
/EOF;